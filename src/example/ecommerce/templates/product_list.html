{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Product Listing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- FILTER SECTION -->
<div class="container mt-4">
    <h3 class="mb-3">Product Filters</h3>

    <form method="get" class="row g-3 p-4 bg-white rounded shadow-sm">

        <!-- SEARCH -->
        <div class="col-md-3">
            <label class="form-label">Search</label>
            <input type="text" name="search" class="form-control" value="{{ request.GET.search }}">
        </div>

        <!-- CATEGORY -->
        <div class="col-md-3">
            <label class="form-label">Category</label>
            <select name="category" class="form-select">
                <option value="">All</option>
                {% for c in categories %}
                    <option value="{{ c.key }}" {% if request.GET.category == c.key %}selected{% endif %}>{{ c.key }} ({{c.doc_count}}) </option>
                {% endfor %}
            </select>
        </div>

        <!-- BRAND -->
        <div class="col-md-3">
            <label class="form-label">Brand</label>
            <select name="brand" class="form-select">
                <option value="">All</option>
                {% for b in brands %}
                    <option value="{{ b.key }}" {% if request.GET.brand == b.key %}selected{% endif %}>{{ b.key }} ({{b.doc_count}}) </option>
                {% endfor %}
            </select>
        </div>


        <!-- Attributes -->
        <div class="col-md-3">
            <label class="form-label">Attributes</label>
            <select name="attr" class="form-select">
                <option value="">All</option>
                {% for attr in attributes %}
                    <option value="{{ attr.key }}" {% if request.GET.attr == attr.key %}selected{% endif %}>{{ attr.key}} ({{attr.doc_count}}) </option>
                {% endfor %}
            </select>
        </div>


        <!-- SORT BY -->
        <div class="col-md-3">
            <label class="form-label">Sort By</label>
            <select name="sort" class="form-select">
                <option value="">Default</option>
                <option value="new" {% if request.GET.sort == "new" %}selected{% endif %}>Newest First</option>
                <option value="old" {% if request.GET.sort == "old" %}selected{% endif %}>Oldest First</option>
                <option value="price_asc" {% if request.GET.sort == "price_asc" %}selected{% endif %}>Price: Low to High</option>
                <option value="price_desc" {% if request.GET.sort == "price_desc" %}selected{% endif %}>Price: High to Low</option>
                <option value="rating_desc" {% if request.GET.sort == "rating_desc" %}selected{% endif %}>Rating: High to Low</option>
                <option value="rating_asc" {% if request.GET.sort == "rating_asc" %}selected{% endif %}>Rating: Low to High</option>
            </select>
        </div>

        <!-- PRICE RANGE -->
        <div class="col-md-3">
            <label class="form-label">Min Price</label>
            <input type="number" name="min_price" class="form-control" value="{{ request.GET.min_price }}">
        </div>

        <div class="col-md-3">
            <label class="form-label">Max Price</label>
            <input type="number" name="max_price" class="form-control" value="{{ request.GET.max_price }}">
        </div>

        <!-- RATING -->
        <div class="col-md-3">
            <label class="form-label">Min Rating</label>
            <input type="number" step="0.1" name="min_rating" class="form-control" value="{{ request.GET.min_rating }}">
        </div>

        <!-- DATE RANGE -->
        <div class="col-md-3">
            <label class="form-label">Start Date</label>
            <input type="date" name="start_date" class="form-control" value="{{ request.GET.start_date }}">
        </div>

        <div class="col-md-3">
            <label class="form-label">End Date</label>
            <input type="date" name="end_date" class="form-control" value="{{ request.GET.end_date }}">
        </div>

        <div class="col-md-12 text-end mt-3">
            <button class="btn btn-primary px-4">Filter</button>
            <a href="{% url 'product_list' %}" class="btn btn-secondary px-4">Reset</a>
        </div>

    </form>
</div>


<!-- SEARCH SUMMARY -->
{% if count %}
<div class="container mt-4">
    <div class="card shadow-sm p-4 mb-4">
        <h5 class="fw-bold mb-4">
            Search Results
            <span class="text-primary">({{ count }} items found)</span>
        </h5>

        <div class="row">

        </div>
    </div>
</div>
{% endif %}


<!-- PRODUCT LIST -->
<div class="container mt-4">
    <div class="row">

        {% for p in products %}
        <div class="col-md-3 mb-4">
            <div class="card shadow-sm h-100">

                {% if p.images %}
                <img src="{{ p.images.0 }}" class="card-img-top" alt="Product Image">
                {% endif %}

                <div class="card-body">
                    <h5 class="card-title">{{ p.title}}</h5>
                    <p class="card-title">{{ p.description }}</p>


                    <p class="text-muted">{{ p.brand }}</p>

                    <p>
                        <strong>â‚¹{{ p.selling_price }}</strong>
                        {% if p.actual_price %}
                        <span class="text-decoration-line-through text-muted">{{ p.actual_price }}</span>
                        {% endif %}
                    </p>

                    <p class="small text-muted">Rating: {{ p.average_rating }}</p>
                </div>

                <div class="card-footer bg-white">
                    <a href="{{ p.url }}" target="_blank" class="btn btn-sm btn-outline-primary w-100">
                        View Product
                    </a>
                </div>

            </div>
        </div>

        {% empty %}
        <p>No products found.</p>
        {% endfor %}

    </div>
</div>


<!-- PAGINATION -->
<div class="container mb-5">
    <nav>
        <ul class="pagination justify-content-center">

            {% if products.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ products.previous_page_number }}">&laquo;</a>
            </li>
            {% endif %}

            {% for num in products.paginator.page_range %}
                <li class="page-item {% if num == products.number %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
            {% endfor %}

            {% if products.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ products.next_page_number }}">&raquo;</a>
            </li>
            {% endif %}

        </ul>
    </nav>
</div>

</body>
</html>
